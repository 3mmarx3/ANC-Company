<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form with Back Button</title>
    <style>
        .hidden { display: none; }
        .on { background-color: yellow; }
        .ok { background-color: green; }
    </style>
</head>
<body>
    <div id="timeline">
        <div class="col step1 on">Step 1</div>
        <div class="col step2">Step 2</div>
        <div class="col step3">Step 3</div>
    </div>
    <form id="form">
        <div id="step1" class="step">
            <input type="text" class="text" placeholder="First Name">
            <button class="continue" data-target="step2">Continue</button>
        </div>
        <div id="step2" class="step hidden">
            <input type="text" class="text" placeholder="Last Name">
            <button class="back" data-target="step1">Back</button>
            <button class="continue" data-target="step3">Continue</button>
        </div>
        <div id="step3" class="step hidden">
            <input type="text" class="text" placeholder="Phone Number">
            <button class="back" data-target="step2">Back</button>
            <button class="complete">Complete</button>
        </div>
    </form>
    <button id="demo">Demo</button>
    <script>
        console.clear();

        // small funcs
        function _id(str) { return document.getElementById(str); }
        function log(str) { console.log(str); }

        // VARs
        var form = _id('form');
        var timeline = _id('timeline');

        // Click handlers
        form.addEventListener('focusin', function (event) {
            if (event.target.matches('input, textarea, select')) {
                event.target.parentNode.classList.add('on');
            }
        });

        form.addEventListener('focusout', function (event) {
            if (event.target.matches('input, textarea, select')) {
                event.target.parentNode.classList.remove('on');
            }
        });

        timeline.addEventListener('click', function (event) {
            if (event.target.matches('.col')) {
                let target = event.target;
                let prev = target.previousElementSibling;

                if (prev && prev.classList.contains('on')) {
                    prev.classList.add('ok');
                }

                if (target.classList.contains('ok') && target.classList.contains('on')) {
                    target.classList.remove('on');
                    target.classList.remove('ok');
                    return;
                }

                if (target.className.indexOf('on') > -1) {
                    target.classList.add('ok');
                }
                target.classList.add('on');
            }
        });

        form.addEventListener('click', function (event) {
            if (event.target.matches('.continue')) {
                event.preventDefault();

                let par = event.target.parentNode;
                let target = event.target.getAttribute('data-target');
                let id = _id(target);
                let timelineTarget = timeline.querySelector('.' + target);
                let timelinePrev = timelineTarget ? timelineTarget.previousElementSibling : null;

                if (timelineTarget) timelineTarget.classList.add('on');
                if (timelinePrev) timelinePrev.classList.add('ok');

                if (target === 'complete') {
                    let cur = event.target.parentNode.id;
                    timeline.querySelector('.' + cur).classList.add('ok');
                    id = event.target.parentNode.nextElementSibling;
                    if (id) id.querySelector('img').classList.remove('hidden');
                }

                par.classList.add('hidden');
                if (id) id.classList.remove('hidden');
            } else if (event.target.matches('.reset')) {
                event.preventDefault();
                let cols = timeline.querySelectorAll('.col');
                for (let i = 0; i < cols.length; i++) {
                    cols[i].classList.remove('on', 'ok');
                    if (i === 0) cols[i].classList.add('on');
                }
                let steps = document.querySelectorAll('.step');
                for (let i = 0; i < steps.length; i++) {
                    steps[i].classList.add('hidden');
                    if (i === 0) steps[i].classList.remove('hidden');
                    let c = steps[i].querySelector('.continue');
                    if (c) c.classList.remove('hidden');
                }
            } else if (event.target.matches('.view-all')) {
                event.preventDefault();
                let steps = document.querySelectorAll('.step');
                for (let i = 0; i < steps.length; i++) {
                    steps[i].classList.remove('hidden');
                    let c = steps[i].querySelector('.continue');
                    if (c) c.classList.add('hidden');
                }
            } else if (event.target.matches('.back')) {
                event.preventDefault();

                let par = event.target.parentNode;
                let target = event.target.getAttribute('data-target');
                let id = _id(target);
                let timelineTarget = timeline.querySelector('.' + target);
                let cur = par.id;

                if (timelineTarget) timelineTarget.classList.remove('ok', 'on');
                timeline.querySelector('.' + cur).classList.remove('on');

                par.classList.add('hidden');
                if (id) id.classList.remove('hidden');
            }
        });

        // DEMO MODE
        function typer(el, text, callback, n) {
            el.focus();
            const speed = Math.floor((Math.random() * 50) + 30);
            n = n || 0;
            var val = el.value;
            if (n < text.length) {
                el.value = text.substring(0, n + 1);
                n++;
                setTimeout(function () {
                    typer(el, text, callback, n);
                }, speed);
            } else {
                callback();
            }
        }

        document.getElementById('demo').addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector('.reset').click();
            demoMode();
        });

        function demoMode() {
            let inputs = document.querySelectorAll('.step .text');
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].value = '';
            }
            const wait = 700;
            const continues = document.querySelectorAll('.continue');

            typer(inputs[0], 'Tommie is the best ...', function () {
                setTimeout(function () {
                    typer(inputs[0], 'Tommie', function () {
                        typer(inputs[1], 'Hansen', function () {
                            setTimeout(function () {
                                continues[0].click();
                                setTimeout(step2, wait * 2);
                            }, wait);
                        });
                    });
                }, wait);
            });

            function step2() {
                typer(inputs[2], '+46 738 500 659', function () {
                    typer(inputs[3], 'Stadsvägen 12', function () {
                        typer(inputs[4], '115 39', function () {
                            typer(inputs[5], 'Hägersten', function () {
                                typer(inputs[6], 'tommie@me.com', function () {
                                    typer(inputs[7], 'tommie@me.com', function () {
                                        setTimeout(function () {
                                            continues[1].click();
                                            setTimeout(step3, wait * 2);
                                        }, wait);
                                    });
                                });
                            });
                        });
                    });
                });
            }

            function step3() {
                typer(inputs[8], 'Åsa', function () {
                    typer(inputs[9], 'Svensson', function () {
                        typer(inputs[10], 'SWE983423092340', function () {
                            setTimeout(function () {
                                inputs[10].blur();
                                continues[2].click();
                            }, wait);
                        });
                    });
                });
            }
        }
    </script>
</body>
</html>
